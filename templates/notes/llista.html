{% extends "partials/full_layout.html" %}
{% block title %}Qualificacions{% endblock %}

{% block content %}
<h2>Qualificacions</h2>

<div class="top-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <!-- BotÃ³ afegir -->
  <a href="{{ url_for('notes.add_nota') }}" class="btn">Afegir Nota</a>

  <!-- Cercador + Informe -->
  <form method="GET" action="{{ url_for('notes.llista_notes') }}" style="display: flex; gap: 10px; align-items: center;">
  <select name="search" style="padding: 8px; width: 250px; border-radius: 5px; border: 1px solid #ccc;">
    <option value="">Selecciona un alumne</option>
    {% for id, nom in alumnes_dict.items() %}
      <option value="{{ nom }}" {% if request.args.get('search') == nom %}selected{% endif %}>{{ nom }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="btn">Buscar</button>

  {% if notes and notes|length > 0 %}
    <a href="{{ url_for('notes.informe_alumne', alumne_id=notes[0].alumne_id|string) }}" class="btn">Veure Informe</a>
  {% endif %}
</form>

</div>

{% if notes %}
<div class="table-container">
  <table class="styled-table">
    <thead>
      <tr>
        <th>Alumne</th>
        <th>Assignatura</th>
        <th>RA</th>
        <th>Nota</th>
        <th>Accions</th>
      </tr>
    </thead>
    <tbody>
      {% for nota in notes %}
      <tr>
        <td>{{ alumnes_dict.get(nota.alumne_id|string, 'Alumne no trobat') }}</td>
        <td>{{ assignatures_dict.get(nota.assignatura_id|string, 'Assignatura no trobada') }}</td>
        <td>{{ nota.ra_id }}</td>
        <td>{{ nota.nota }}</td>
        <td>
          <div class="action-buttons">
            <a href="{{ url_for('notes.edit_nota', id=nota._id) }}" class="btn-edit">Editar</a>
            <form method="POST" action="{{ url_for('notes.delete_nota', id=nota._id) }}">
              <button type="submit" class="btn-delete" onclick="return confirm('Segur que vols eliminar aquesta nota?');">
                Eliminar
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
  <p>No hi ha qualificacions registrades.</p>
{% endif %}
{% endblock %}
